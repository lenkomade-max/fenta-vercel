# Billing — Оптимизация затрат

## 1. Используйте бесплатный сток

Pexels интеграция **не потребляет** KAI кредиты:

```json
{
  "type": "Input.Stock",
  "params": {
    "provider": "pexels",
    "query": "city night",
    "count": 5
  }
}
// Стоимость: $0.00
```

**Сток vs AI генерация:**
| Источник | KAI кредиты |
|----------|-------------|
| Pexels (сток) | 0 |
| Flux Pro (изображение) | 8 |
| Sora (10 сек видео) | 100 |

---

## 2. Выбирайте подходящие модели

Более дешевые модели для простых задач:

### LLM модели

| Задача | Premium | Budget | Экономия |
|--------|---------|--------|----------|
| Скрипт | GPT-4 ($0.06/1K) | GPT-3.5 ($0.0015/1K) | 97% |
| Перевод | Claude 3 Sonnet | GPT-3.5 | 80% |

**Когда использовать GPT-4:**
- Сложные сценарии
- Творческий контент
- Важный тон и стиль

**Когда использовать GPT-3.5:**
- Простые факты
- Переводы
- Форматирование

### Модели генерации изображений

| Модель | Кредиты | Качество |
|--------|---------|----------|
| Qwen Image | 6 | Хорошее |
| Flux Pro | 8 | Отличное |
| GPT-4o Image | 10 | Отличное |
| Midjourney | 12 | Премиум |

### Модели генерации видео

| Модель | Кредиты | Качество | Скорость |
|--------|---------|----------|----------|
| Minimax | 50 | Хорошее | Быстро |
| Seedance | 55 | Хорошее | Быстро |
| Wan 2.5 | 60 | Отличное | Средне |
| Veo 3.1 | 80 | Отличное | Средне |
| Sora 2 | 100 | Премиум | Медленно |

---

## 3. Оптимизируйте разрешение

Рендерьте в подходящем качестве:

| Разрешение | Render seconds (60с) | Стоимость |
|------------|---------------------|-----------|
| 720p | 60 сек | $0.90 |
| 1080p | 90 сек | $1.35 |
| 4K | 180 сек | $2.70 |

**Рекомендации по платформам:**
| Платформа | Рекомендуемое |
|-----------|--------------|
| TikTok | 1080p |
| Instagram Reels | 1080p |
| YouTube Shorts | 1080p |
| YouTube (long) | 1080p/4K |
| Twitter | 720p |

---

## 4. Batch Processing (будущее)

Запланированные jobs со скидкой:
- 30% скидка на scheduled jobs
- Выполнение в периоды низкой нагрузки

---

## 5. Переиспользуйте ассеты

Кэшируйте сгенерированные ассеты:

```
Тот же промпт = переиспользование предыдущей генерации
```

Экономия до 100% на повторяющемся контенте.

**Типичные сценарии:**
- Логотип канала
- Интро/аутро
- Фоновая музыка
- Overlay эффекты

---

## 6. Credit Packs (предоплата)

Скидки за bulk purchase:

| Пакет | Кредиты | Цена | За кредит | Экономия |
|-------|---------|------|-----------|----------|
| Small | 1,000 | $40 | $0.040 | 20% |
| Medium | 5,000 | $175 | $0.035 | 30% |
| Large | 20,000 | $600 | $0.030 | 40% |

**Преимущества:**
- Никогда не истекают
- Применяются до месячной квоты
- Переносимые между проектами

---

## 7. Правильный выбор TTS

| Engine | Стоимость | Качество | Использование |
|--------|-----------|----------|---------------|
| Kokoro | Render seconds | Хорошее | Стандартный контент |
| OpenAI TTS | LLM tokens | Отличное | Важный контент |
| ElevenLabs | KAI credits | Премиум | Профессиональное |

**Kokoro = самый дешевый вариант** для большинства случаев.

---

## 8. Мониторинг и алерты

Настройте алерты для предотвращения неожиданных расходов:

```json
{
  "alerts": {
    "at_80_percent": true,
    "at_90_percent": true,
    "daily_digest": true
  },
  "overage_cap_usd": 50.00
}
```

---

## 9. Тестовый режим

Используйте test mode для проверки workflow:

```http
POST /v1/workflows/{id}/run
{"mode": "test"}
```

- Рендерит только первые 10-15 секунд
- Экономит ~75% render seconds

---

## 10. Оптимизация workflow

### Минимизируйте узлы генерации

**Неоптимально:**
```
4 × Input.KAI.GenerateVideo (400 credits)
```

**Оптимально:**
```
1 × Input.KAI.GenerateVideo + 3 × Input.Stock (100 credits)
```

### Группируйте генерации

Используйте `variations` вместо множественных узлов:

```json
{
  "type": "Input.KAI.GenerateImage",
  "params": {
    "variations": 4  // Генерирует 4 варианта за один запрос
  }
}
```

---

## Сравнение стратегий

### Сценарий: 60 секунд видео ежедневно (30 дней)

**Стратегия 1: Все AI генерация**
- 4 Sora клипа/видео × 30 = 12,000 KAI credits
- Стоимость: ~$480/месяц

**Стратегия 2: Сток + минимальный AI**
- 1 Sora клип + 3 сток/видео × 30 = 3,000 KAI credits
- Стоимость: ~$120/месяц
- **Экономия: 75%**

**Стратегия 3: Только сток**
- 0 KAI credits
- Стоимость: ~$40/месяц (только render)
- **Экономия: 92%**

---

## Калькулятор экономии

### Формула месячных расходов

```
Месячные расходы =
  Подписка
  + (Токены_сверх_квоты × Тариф)
  + (KAI_сверх_квоты × Тариф)
  + (Render_сверх_квоты × Тариф)
  + (Storage_сверх_квоты × Тариф)
```

### Пример (Pro план)

```
$99 (подписка)
+ 500K токенов сверх × $0.08/100K = $0.40
+ 300 KAI сверх × $0.04 = $12.00
+ 1000 render сек сверх × $0.015 = $15.00
─────────────────────────────────
Итого: $126.40/месяц
```

---

## Чек-лист оптимизации

- [ ] Использую Pexels для B-roll
- [ ] Выбираю правильную модель для задачи
- [ ] Рендерю в подходящем разрешении
- [ ] Переиспользую частые ассеты
- [ ] Настроил алерты использования
- [ ] Установил overage cap
- [ ] Тестирую в test mode
- [ ] Минимизирую AI генерации в workflow
